// Input 0
/*

 uDeferred library

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @license http://creativecommons.org/licenses/by/3.0/
*/
(function(){var b=function(){return this}();b.Deferred=typeof b.jQuery!=="undefined"&&typeof b.jQuery.Deferred!=="undefined"?b.jQuery.Deferred:function(){if(!(this instanceof arguments.callee))return new b.Deferred;var g=[0,[],[]],j=0,e,a=null,d,n=this,l=function(a,d,b){if(!j){j=a;e=d;for(a=g[a];a.length;)a.shift().apply(b,e);g=null;return n}},q=function(a,d){j==a?d.apply(this,e):j||g[a].push(d);return this};n.promise=function(b){if(!b&&a)return a;a=b?b:a?a:{};for(var e in d)d.hasOwnProperty(e)&&
(a[e]=d[e]);return a};n.resolve=function(){return l(1,arguments,a)};n.reject=function(){return l(2,arguments,a)};n.resolveWith=function(){var a=arguments.shift();return l(1,arguments,a)};n.rejectWith=function(){var a=arguments.shift();return l(2,arguments,a)};d={done:function(a){return q.call(this,1,a)},fail:function(a){return q.call(this,2,a)},then:function(a,d){return this.done(a).fail(d)},always:function(a){return this.then(a,a)},isResolved:function(){return j==1},isRejected:function(){return j==
2}}}})();
// Input 1
/*

 CRC32

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @license http://creativecommons.org/licenses/by/3.0/
*/
(function(){for(var b=function(){return this}(),g=Array(256),j=0;j<256;j++){for(var e=j,a=0;a<8;a++)e=e&1?3988292384^e>>>1:e>>>1;g[j]=e}b.crc32=function(a){for(var b=-1,e=0,j=a.length;e<j;e++)b=b>>>8^g[(b^a.charCodeAt(e))&255];return b^-1}})();
// Input 2
/*

 minimal logging library

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @license http://creativecommons.org/licenses/by/3.0/
*/
(function(){var b=function(){return this}().ULogger=function(){if(!(this instanceof arguments.callee))return new b;var g=[];this.addListener=function(j,e){if(!e=="undefined")e=b.LOG_INFO;g.push([e,j])};this.log=function(b,e){for(var a=0;a<g.length;a++){var d=g[a];e>=d[0]&&d[1].call(null,b,e)}}};b.LOG_ALL=0;b.LOG_DEBUG3=98;b.LOG_DEBUG2=99;b.LOG_DEBUG=100;b.LOG_INFO=101;b.LOG_WARNING=102;b.LOG_ERROR=103;b.LOG_FATAL=1E3})();
// Input 3
/*

 APNG-canvas

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @link https://github.com/davidmz/apng-canvas
 @license https://github.com/davidmz/apng-canvas/blob/master/LICENSE (MIT License)
*/
(function(){var b=function(){return this}(),g=b.APNG={},j=null;g.checkNativeFeatures=function(k){var x=!j,c=x?j=new Deferred:j;k&&c.promise().done(k);if(!x)return c.promise();var b={canvas:!1,apng:!1},o=document.createElement("canvas");if(typeof o.getContext=="undefined")d.log("Feature: canvas is NOT supported",a.LOG_INFO),c.resolve(b);else{d.log("Feature: canvas is supported",a.LOG_INFO);b.canvas=!0;var e=new Image;e.onload=function(){var k=o.getContext("2d");k.drawImage(e,0,0);k.getImageData(0,
0,1,1).data[3]===0?(b.apng=!0,d.log("Feature: native APNG is supported",a.LOG_INFO)):d.log("Feature: native APNG is NOT supported",a.LOG_INFO);c.resolve(b)};e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACGFjVEwAAAABAAAAAcMq2TYAAAANSURBVAiZY2BgYPgPAAEEAQB9ssjfAAAAGmZjVEwAAAAAAAAAAQAAAAEAAAAAAAAAAAD6A+gBAbNU+2sAAAARZmRBVAAAAAEImWNgYGBgAAAABQAB6MzFdgAAAABJRU5ErkJggg=="}return c.promise()};var e=null;g.ifNeeded=function(k){var a=!e,c=a?e=new Deferred:e;k&&c.promise().done(k);
if(!a)return c.promise();if(location.protocol!="http:"&&location.protocol!="https:")return c.reject("apng-canvas doesn't work on pages loaded by '"+location.protocol+"' protocol"),c.promise();this.checkNativeFeatures().done(function(k){k.canvas&&!k.apng?c.resolve():(k.canvas||c.reject("Browser doesn't support canvas"),k.apng&&c.reject("Browser has native APNG support"))}).done(function(){c.reject()});return c.promise()};g.createAPNGCanvas=function(k,a){var c=new Deferred;a&&c.promise().done(a);t(k).done(function(k){y(k).done(function(a){var b=
document.createElement("canvas");b.width=a.width;b.height=a.height;if(a.isAnimated)z(a,b);else{var d=new Image;d.onload=function(){b.getContext("2d").drawImage(d,0,0)};a=new s;a.append(k);d.src=a.getUrl("image/png")}c.resolve(b)}).fail(function(a){c.reject(a)})}).fail(function(a){c.reject(a)});return c.promise()};g.replaceImage=function(a){return g.createAPNGCanvas(a.src).done(function(b){a.parentNode.insertBefore(b,a);a.parentNode.removeChild(a)})};var a=ULogger,d=new a;g.onLog=function(k,b){if(!b==
"undefined")b=a.LOG_INFO;d.addListener(k,b)};var n=String.fromCharCode(137,80,78,71,13,10,26,10),l=function(a){for(var b=0,c=0;c<4;c++)b+=a.charCodeAt(c)<<(3-c)*8;return b},q=function(a){for(var b=0,c=0;c<2;c++)b+=a.charCodeAt(c)<<(1-c)*8;return b},w=function(a,b){var c="";c+=r(b.length);c+=a;c+=b;c+=r(crc32(a+b));return c},r=function(a){return String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,a&255)},s=function(){this.parts=[]};s.prototype.append=function(a){this.parts.push(a)};s.prototype.getUrl=
function(a){return"data:"+a+";base64,"+btoa(this.parts.join(""))};typeof XMLHttpRequest.prototype.responseBody!="undefined"&&typeof document.addEventListener!="undefined"&&document.addEventListener("DOMContentLoaded",function(){var a=document.createElement("script");a.setAttribute("type","text/vbscript");a.text="Function APNGIEBinaryToBinStr(Binary)\r\n   APNGIEBinaryToBinStr = CStr(Binary)\r\nEnd Function\r\n";document.body.appendChild(a)});var t=function(k){var e=new Deferred;d.log("Starting load url: "+
k,a.LOG_INFO);var c=new XMLHttpRequest,j=b.BlobBuilder||b.WebKitBlobBuilder,o=typeof this.responseBody!="undefined",g=typeof this.responseType!="undefined"&&typeof j!="undefined",h=typeof c.overrideMimeType!="undefined"&&!g;d.log("useResponseBody: "+(o?1:0),a.LOG_DEBUG2);d.log("useResponseType: "+(g?1:0),a.LOG_DEBUG2);d.log("useXUserDefined: "+(h?1:0),a.LOG_DEBUG2);c.open("GET",k,!0);g?c.responseType="arraybuffer":h&&c.overrideMimeType("text/plain; charset=x-user-defined");c.onreadystatechange=function(){if(this.readyState==
4&&this.status==200)if(d.log("Done load url: "+k,a.LOG_INFO),g){var b=new j;b.append(this.response);var i=new FileReader;i.onload=function(){e.resolve(this.result)};i.readAsBinaryString(b.getBlob())}else{b="";if(o)for(var i=APNGIEBinaryToBinStr(this.responseBody),h=0,m=i.length;h<m;h++){var l=i.charCodeAt(h);b+=String.fromCharCode(l&255,l>>8&255)}else{i=this.responseText;h=0;for(m=i.length;h<m;++h)b+=String.fromCharCode(i.charCodeAt(h)&255)}e.resolve(b)}else this.readyState==4&&(d.log("Fail load url: "+
k,a.LOG_ERROR),e.reject(c))};c.send();return e.promise()},y=function(b){var e=new Deferred;d.log("Start data parsing: "+escape(b.substr(0,8))+"...",a.LOG_INFO);if(b.substr(0,8)!=n)return d.log("Invalid PNG file signature: "+escape(b.substr(0,8))+"...",a.LOG_ERROR),e.reject("Invalid PNG file signature"),e.promise();var c={width:0,height:0,isAnimated:!1,numPlays:0,frames:[]},g,o="",j="",h=8,f=null;do{var i=l(b.substr(h,4)),p=b.substr(h+4,4),m;d.log("Found chunk: "+p,a.LOG_DEBUG2);switch(p){case "IHDR":g=
m=b.substr(h+8,i);c.width=l(m.substr(0,4));c.height=l(m.substr(4,4));d.log("Image has size "+c.width+"x"+c.height,a.LOG_DEBUG);break;case "acTL":c.isAnimated=!0;c.numPlays=l(b.substr(h+8+4,4));d.log("Image is animated",a.LOG_DEBUG);break;case "fcTL":f&&c.frames.push(f);m=b.substr(h+8,i);f={};f.width=l(m.substr(4,4));f.height=l(m.substr(8,4));f.left=l(m.substr(12,4));f.top=l(m.substr(16,4));var t=q(m.substr(20,2)),u=q(m.substr(22,2));u==0&&(u=100);f.delay=1E3*t/u;f.disposeOp=m.charCodeAt(24);f.blendOp=
m.charCodeAt(25);f.dataParts=[];break;case "fdAT":f&&f.dataParts.push(b.substr(h+8+4,i-4));break;case "IDAT":f&&f.dataParts.push(b.substr(h+8,i));break;case "IEND":j=b.substr(h,i+12);break;default:o+=b.substr(h,i+12)}h+=12+i}while(p!="IEND"&&h<b.length);f&&c.frames.push(f);d.log("Found "+c.frames.length+" frames",a.LOG_DEBUG);c.isAnimated||e.resolve(c);d.log("Start making frames",a.LOG_INFO);for(var v=0,b=0;b<c.frames.length;b++){h=new Image;f=c.frames[b];f.img=h;h.onload=function(){v++;d.log("Image created ("+
v+")",a.LOG_DEBUG2);v==c.frames.length&&e.resolve(c)};h.onerror=function(){d.log("Image creation error",a.LOG_ERROR);e.reject("Image creation error")};i=new s;i.append(n);g=r(f.width)+r(f.height)+g.substr(8);i.append(w("IHDR",g));i.append(o);for(p=0;p<f.dataParts.length;p++)i.append(w("IDAT",f.dataParts[p]));i.append(j);i=i.getUrl("image/png");d.log("Image url: "+i.substr(0,64)+"...",a.LOG_DEBUG2);h.src=i;delete f.dataParts}return e.promise()},z=function(a,b){var c=b.getContext("2d"),e=0,d=null,g=
function(){var b=e++%a.frames.length,f=a.frames[b];if(b==0&&(c.clearRect(0,0,a.width,a.height),d=null,f.disposeOp==2))f.disposeOp=1;d&&d.disposeOp==1?c.clearRect(d.left,d.top,d.width,d.height):d&&d.disposeOp==2&&c.putImageData(d.iData,d.left,d.top);d=f;d.iData=null;if(d.disposeOp==2)d.iData=c.getImageData(f.left,f.top,f.width,f.height);f.blendOp==0&&c.clearRect(f.left,f.top,f.width,f.height);c.drawImage(f.img,f.left,f.top);(a.numPlays==0||e/a.frames.length<a.numPlays)&&setTimeout(g,f.delay)};g()}})();
