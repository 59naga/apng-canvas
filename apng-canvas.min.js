// Input 0
/*

 uDeferred library

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @license http://creativecommons.org/licenses/by/3.0/
*/
(function(){var a=function(){return this}(),f;f=typeof a.jQuery!=="undefined"&&typeof a.jQuery.Deferred!=="undefined"?a.Deferred=a.jQuery.Deferred:a.Deferred=function(){if(!(this instanceof arguments.callee))return new f;var h=[0,[],[]],a=0,n,e=null,k,r=this,o=function(m,e,k){if(!a){a=m;n=e;for(m=h[m];m.length;)m.shift().apply(k,n);h=null;return r}},i=function(m,e){a==m?e.apply(this,n):a||h[m].push(e);return this};r.promise=function(m){if(!m&&e)return e;e=m?m:e?e:{};for(var a in k)k.hasOwnProperty(a)&&
(e[a]=k[a]);return e};r.resolve=function(){return o(1,arguments,e)};r.reject=function(){return o(2,arguments,e)};r.resolveWith=function(){var a=Array.prototype.slice.call(arguments),e=a.shift();return o(1,a,e)};r.rejectWith=function(){var a=Array.prototype.slice.call(arguments),e=a.shift();return o(2,a,e)};k={done:function(a){return i.call(this,1,a)},fail:function(a){return i.call(this,2,a)},then:function(a,e){return this.done(a).fail(e)},always:function(a){return this.then(a,a)},isResolved:function(){return a==
1},isRejected:function(){return a==2},promise:function(){return this}}};var i=function(a,f){return function(){return a.apply(f,arguments)}};f.pipeline=function(){var a,p=arguments,n,e=function(){if(n.length){var k=n.shift().apply(null,arguments);typeof k.promise=="function"?k.promise().then(e,i(a.reject,a)):e.apply(null,[k])}else a.resolve.apply(a,arguments)};return function(){a=new f;n=Array.prototype.slice.call(arguments);e.apply(null,p);return a.promise()}}})();
// Input 1
/*

 CRC32

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @license http://creativecommons.org/licenses/by/3.0/
*/
(function(){for(var a=function(){return this}(),f=Array(256),i=0;i<256;i++){for(var h=i,p=0;p<8;p++)h=h&1?3988292384^h>>>1:h>>>1;f[i]=h}a.crc32=function(a){for(var e=-1,h=0,i=a.length;h<i;h++)e=e>>>8^f[(e^a.charCodeAt(h))&255];return e^-1}})();
// Input 2
/*

 APNG-canvas

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @link https://github.com/davidmz/apng-canvas
 @license https://github.com/davidmz/apng-canvas/blob/master/LICENSE (MIT License)
*/
(function(){var a=function(){return this}(),f=a.jQuery||null,i=!!document.getCSSCanvasContext,h=a.APNG={},p=null;h.checkNativeFeatures=function(c){var d=!p,b=d?p=new Deferred:p;c&&b.promise().done(c);if(!d)return b.promise();var a={canvas:!1,apng:!1},e=document.createElement("canvas");if(typeof e.getContext=="undefined")b.resolve(a);else{a.canvas=!0;var g=new Image;g.onload=function(){var c=e.getContext("2d");c.drawImage(g,0,0);if(c.getImageData(0,0,1,1).data[3]===0)a.apng=!0;b.resolve(a)};g.src=
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACGFjVEwAAAABAAAAAcMq2TYAAAANSURBVAiZY2BgYPgPAAEEAQB9ssjfAAAAGmZjVEwAAAAAAAAAAQAAAAEAAAAAAAAAAAD6A+gBAbNU+2sAAAARZmRBVAAAAAEImWNgYGBgAAAABQAB6MzFdgAAAABJRU5ErkJggg=="}return b.promise()};var n=null;h.ifNeeded=function(c){var a=!n,b=a?n=new Deferred:n;c&&b.promise().done(c);if(!a)return b.promise();if(location.protocol!="http:"&&location.protocol!="https:")return b.reject("apng-canvas doesn't work on pages loaded by '"+location.protocol+
"' protocol"),b.promise();this.checkNativeFeatures().done(function(c){c.canvas&&!c.apng?b.resolve():(c.canvas||b.reject("Browser doesn't support canvas"),c.apng&&b.reject("Browser has native APNG support"))}).done(function(){b.reject()});return b.promise()};h.createAPNGCanvas=function(c,a){var b=new Deferred;a&&b.promise().done(a);s.createFromUrl(c).done(function(){b.resolve(this.addCanvas())}).fail(u(b.reject,b));return b.promise()};h.animateImage=function(c){if(i){var d=new Deferred;c.hasAttribute("data-apng-src")?
d.reject("Image already animated"):s.createFromUrl(c.src).done(function(){var b=this.getCSSCanvasContextName();if(!c.hasAttribute("width")&&!c.style.width)c.style.width=a.getComputedStyle(c).width;if(!c.hasAttribute("height")&&!c.style.height)c.style.height=a.getComputedStyle(c).height;c.setAttribute("data-apng-src",c.src);c.src=k;c.style.backgroundImage="-webkit-canvas("+b+")";c.style.backgroundSize="100% 100%";d.resolve()}).fail(u(d.reject,d));return d.promise()}else return this.replaceImage(c)};
h.replaceImage=function(c){if(c.hasAttribute("data-apng-src")){var a=new Deferred;a.reject("Image already animated");return a.promise()}else return h.createAPNGCanvas(c.src).done(function(a){for(var d=0;d<c.attributes.length;d++){var e=c.attributes[d];["alt","src","usemap","ismap"].indexOf(e.nodeName)==-1&&a.setAttributeNode(e.cloneNode());c.setAttribute("data-apng-src",c.src)}if(f&&(d=f(c).data("events")))for(var g in d)for(var e=0,h=d[g].length;e<h;e++){var v=d[g][e];f(a).bind(g+(v.namespace?".":
"")+v.namespace,v.data,v.handler)}g=c.parentNode;g.insertBefore(a,c);g.removeChild(c)})};var e=String.fromCharCode(137,80,78,71,13,10,26,10),k="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",r=1,o=function(c){for(var a=0,b=0;b<4;b++)a+=c.charCodeAt(b)<<(3-b)*8;return a},B=function(c){for(var a=0,b=0;b<2;b++)a+=c.charCodeAt(b)<<(1-b)*8;return a},m=function(c,a){var b="";b+=t(a.length);b+=c;b+=a;b+=t(crc32(c+a));return b},t=function(a){return String.fromCharCode(a>>
24&255,a>>16&255,a>>8&255,a&255)},y=function(){this.parts=[]};y.prototype.append=function(a){this.parts.push(a)};y.prototype.getUrl=function(c){return a.btoa?"data:"+c+";base64,"+btoa(this.parts.join("")):"data:"+c+","+escape(this.parts.join(""))};var u=function(a,d){return function(){return a.apply(d,arguments)}};typeof XMLHttpRequest.prototype.responseBody!="undefined"&&typeof document.addEventListener!="undefined"&&document.addEventListener("DOMContentLoaded",function(){var a=document.createElement("script");
a.setAttribute("type","text/vbscript");a.text="Function APNGIEBinaryToBinStr(Binary)\r\n   APNGIEBinaryToBinStr = CStr(Binary)\r\nEnd Function\r\n";document.body.appendChild(a)});var w=[];(function(){if(w.length)for(var a=w.splice(0,w.length),d=(new Date).getTime();a.length;)a.shift().call(null,d);setTimeout(arguments.callee,1E3/60)})();var x=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||function(a){w.push(a)},C=function(a){for(var d=
0;d<z.length;d++)for(var b=z[d];b.isActive&&b.nextRenderTime<=a;)b.renderFrame(a);x(C)};x(C);var s=function(){var a=this;this.isActive=!1;this.numPlays=this.height=this.width=this.nextRenderTime=0;this.frames=[];this.playTime=0;var d=new Deferred;this.whenReady=u(d.promise,d);this.parsePNGData=function(b){if(b.substr(0,8)!=e)return d.reject("Invalid PNG file signature"),d.promise();var g,D="",h="",i=!1,l=8,j=null;do{var f=o(b.substr(l,4)),k=b.substr(l+4,4),q;switch(k){case "IHDR":g=q=b.substr(l+8,
f);this.width=o(q.substr(0,4));this.height=o(q.substr(4,4));break;case "acTL":i=!0;this.numPlays=o(b.substr(l+8+4,4));break;case "fcTL":j&&this.frames.push(j);q=b.substr(l+8,f);j={};j.width=o(q.substr(4,4));j.height=o(q.substr(8,4));j.left=o(q.substr(12,4));j.top=o(q.substr(16,4));var n=B(q.substr(20,2)),p=B(q.substr(22,2));p==0&&(p=100);j.delay=1E3*n/p;this.playTime+=j.delay;j.disposeOp=q.charCodeAt(24);j.blendOp=q.charCodeAt(25);j.dataParts=[];break;case "fdAT":j&&j.dataParts.push(b.substr(l+8+
4,f-4));break;case "IDAT":j&&j.dataParts.push(b.substr(l+8,f));break;case "IEND":h=b.substr(l,f+12);break;default:D+=b.substr(l,f+12)}l+=12+f}while(k!="IEND"&&l<b.length);j&&this.frames.push(j);if(!i)return d.reject("Non-animated PNG"),d.promise();for(var r=0,s=this,b=0;b<this.frames.length;b++){i=new Image;j=this.frames[b];j.img=i;i.onload=function(){r++;r==s.frames.length&&d.resolveWith(a)};i.onerror=function(){d.reject("Image creation error")};l=new y;l.append(e);g=t(j.width)+t(j.height)+g.substr(8);
l.append(m("IHDR",g));l.append(D);for(f=0;f<j.dataParts.length;f++)l.append(m("IDAT",j.dataParts[f]));l.append(h);i.src=l.getUrl("image/png");delete j.dataParts}return d.promise()};var b=[];this.addCanvas=function(){var a=document.createElement("canvas");a.width=this.width;a.height=this.height;var c=a.getContext("2d");b.push(c);b.length>1&&x(function(){c.putImageData(b[0].getImageData(0,0,a.width,a.height),0,0)});this.isActive=!0;return a};var h=null;this.getCSSCanvasContextName=function(){if(!h){h=
"apng-canvas-css-"+r++;var d=document.getCSSCanvasContext("2d",h,this.width,this.height);b.push(d);b.length>1&&x(function(){d.putImageData(b[0].getImageData(0,0,a.width,a.height),0,0)});this.isActive=!0}return h};var f=0,g=null,i=function(a,c){for(var d=0;d<b.length;d++)b[d][a].apply(b[d],c)};this.renderFrame=function(a){if(b.length!=0){var c=f++%this.frames.length,d=this.frames[c];if(c==0&&(i("clearRect",[0,0,this.width,this.height]),g=null,d.disposeOp==2))d.disposeOp=1;g&&g.disposeOp==1?i("clearRect",
[g.left,g.top,g.width,g.height]):g&&g.disposeOp==2&&i("putImageData",[g.iData,g.left,g.top]);g=d;g.iData=null;if(g.disposeOp==2)g.iData=b[0].getImageData(d.left,d.top,d.width,d.height);d.blendOp==0&&i("clearRect",[d.left,d.top,d.width,d.height]);i("drawImage",[d.img,d.left,d.top]);if(this.numPlays==0||f/this.frames.length<this.numPlays){if(this.nextRenderTime==0)this.nextRenderTime=a;for(;a>this.nextRenderTime+this.playTime;)this.nextRenderTime+=this.playTime;this.nextRenderTime+=d.delay}else this.isActive=
!1}}},E=function(c){var d=new Deferred,b=new XMLHttpRequest,e=a.BlobBuilder||a.WebKitBlobBuilder,h=typeof b.responseBody!="undefined",g=typeof b.responseType!="undefined"&&typeof e!="undefined",f=typeof b.overrideMimeType!="undefined"&&!g;b.open("GET",c,!0);g?b.responseType="arraybuffer":f&&b.overrideMimeType("text/plain; charset=x-user-defined");b.onreadystatechange=function(){if(this.readyState==4&&this.status==200)if(g){var a=new e;a.append(this.response);var c=new FileReader;c.onload=function(){d.resolve(this.result)};
c.readAsBinaryString(a.getBlob())}else{a="";if(h)for(var c=APNGIEBinaryToBinStr(this.responseBody),f=0,i=c.length;f<i;f++){var k=c.charCodeAt(f);a+=String.fromCharCode(k&255,k>>8&255)}else{c=this.responseText;f=0;for(i=c.length;f<i;++f)a+=String.fromCharCode(c.charCodeAt(f)&255)}d.resolve(a)}else this.readyState==4&&d.reject(b)};b.send();return d.promise()},z=[],A={};s.createFromUrl=function(a){var d;a in A?d=A[a]:(d=new s,A[a]=d,z.push(d),Deferred.pipeline(a)(E,u(d.parsePNGData,d)));return d.whenReady()}})();
