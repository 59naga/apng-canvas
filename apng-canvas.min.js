// Input 0
/*

 uDeferred library

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @license http://creativecommons.org/licenses/by/3.0/
*/
(function(){var a=function(){return this}(),i;i=typeof a.jQuery!=="undefined"&&typeof a.jQuery.Deferred!=="undefined"?a.Deferred=a.jQuery.Deferred:a.Deferred=function(){if(!(this instanceof arguments.callee))return new i;var f=[0,[],[]],a=0,l,d=null,m,o=this,h=function(e,d,m){if(!a){a=e;l=d;for(e=f[e];e.length;)e.shift().apply(m,l);f=null;return o}},p=function(e,d){a==e?d.apply(this,l):a||f[e].push(d);return this};o.promise=function(e){if(!e&&d)return d;d=e?e:d?d:{};for(var a in m)m.hasOwnProperty(a)&&
(d[a]=m[a]);return d};o.resolve=function(){return h(1,arguments,d)};o.reject=function(){return h(2,arguments,d)};o.resolveWith=function(){var e=arguments.shift();return h(1,arguments,e)};o.rejectWith=function(){var e=arguments.shift();return h(2,arguments,e)};m={done:function(e){return p.call(this,1,e)},fail:function(e){return p.call(this,2,e)},then:function(e,a){return this.done(e).fail(a)},always:function(a){return this.then(a,a)},isResolved:function(){return a==1},isRejected:function(){return a==
2},promise:function(){return this}}};var h=function(a,h){return function(){return a.apply(h,arguments)}};i.pipeline=function(){var a,q=arguments,l,d=function(){if(l.length){var m=l.shift().apply(null,arguments);typeof m.promise=="function"?m.promise().then(d,h(a.reject,a)):d.apply(null,[m])}else a.resolve.apply(a,arguments)};return function(){a=new i;l=Array.prototype.slice.call(arguments);d.apply(null,q);return a.promise()}}})();
// Input 1
/*

 CRC32

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @license http://creativecommons.org/licenses/by/3.0/
*/
(function(){for(var a=function(){return this}(),i=Array(256),h=0;h<256;h++){for(var f=h,q=0;q<8;q++)f=f&1?3988292384^f>>>1:f>>>1;i[h]=f}a.crc32=function(a){for(var d=-1,h=0,f=a.length;h<f;h++)d=d>>>8^i[(d^a.charCodeAt(h))&255];return d^-1}})();
// Input 2
/*

 APNG-canvas

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @link https://github.com/davidmz/apng-canvas
 @license https://github.com/davidmz/apng-canvas/blob/master/LICENSE (MIT License)
*/
(function(){var a=function(){return this}(),i=a.APNG={},h=null;i.checkNativeFeatures=function(c){var a=!h,b=a?h=new Deferred:h;c&&b.promise().done(c);if(!a)return b.promise();var g={canvas:!1,apng:!1},d=document.createElement("canvas");if(typeof d.getContext=="undefined")b.resolve(g);else{g.canvas=!0;var u=new Image;u.onload=function(){var c=d.getContext("2d");c.drawImage(u,0,0);if(c.getImageData(0,0,1,1).data[3]===0)g.apng=!0;b.resolve(g)};u.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACGFjVEwAAAABAAAAAcMq2TYAAAANSURBVAiZY2BgYPgPAAEEAQB9ssjfAAAAGmZjVEwAAAAAAAAAAQAAAAEAAAAAAAAAAAD6A+gBAbNU+2sAAAARZmRBVAAAAAEImWNgYGBgAAAABQAB6MzFdgAAAABJRU5ErkJggg=="}return b.promise()};
var f=null;i.ifNeeded=function(c){var a=!f,b=a?f=new Deferred:f;c&&b.promise().done(c);if(!a)return b.promise();if(location.protocol!="http:"&&location.protocol!="https:")return b.reject("apng-canvas doesn't work on pages loaded by '"+location.protocol+"' protocol"),b.promise();this.checkNativeFeatures().done(function(c){c.canvas&&!c.apng?b.resolve():(c.canvas||b.reject("Browser doesn't support canvas"),c.apng&&b.reject("Browser has native APNG support"))}).done(function(){b.reject()});return b.promise()};
i.createAPNGCanvas=function(c,a){var b=new Deferred;a&&b.promise().done(a);var g;c in r?g=r[c]:(g=new x,r[c]=g,e.push(g),Deferred.pipeline(c)(y,p(g.parsePNGData,g)));g.whenReady().done(function(){var c=g.addCanvas();b.resolve(c)}).fail(p(b.reject,b));return b.promise()};i.replaceImage=function(c){return i.createAPNGCanvas(c.src).done(function(a){c.parentNode.insertBefore(a,c);c.parentNode.removeChild(c)})};var q=String.fromCharCode(137,80,78,71,13,10,26,10),l=function(c){for(var a=0,b=0;b<4;b++)a+=
c.charCodeAt(b)<<(3-b)*8;return a},d=function(c){for(var a=0,b=0;b<2;b++)a+=c.charCodeAt(b)<<(1-b)*8;return a},m=function(c,a){var b="";b+=o(a.length);b+=c;b+=a;b+=o(crc32(c+a));return b},o=function(c){return String.fromCharCode(c>>24&255,c>>16&255,c>>8&255,c&255)},t=function(){this.parts=[]};t.prototype.append=function(c){this.parts.push(c)};t.prototype.getUrl=function(c){return a.btoa?"data:"+c+";base64,"+btoa(this.parts.join("")):"data:"+c+","+escape(this.parts.join(""))};var p=function(c,a){return function(){return c.apply(a,
arguments)}};typeof XMLHttpRequest.prototype.responseBody!="undefined"&&typeof document.addEventListener!="undefined"&&document.addEventListener("DOMContentLoaded",function(){var a=document.createElement("script");a.setAttribute("type","text/vbscript");a.text="Function APNGIEBinaryToBinStr(Binary)\r\n   APNGIEBinaryToBinStr = CStr(Binary)\r\nEnd Function\r\n";document.body.appendChild(a)});var e=[],r={},s=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||
function(a){setTimeout(a,1E3/60)};(function(){for(var a=(new Date).getTime(),d=0;d<e.length;d++)for(var b=e[d];b.isActive&&b.nextRenderTime<=a;)b.renderFrame(a);s(arguments.callee)})();var x=function(){this.isActive=!1;this.numPlays=this.height=this.width=this.nextRenderTime=0;this.frames=[];this.playTime=0;var a=new Deferred;this.whenReady=p(a.promise,a);this.parsePNGData=function(b){if(b.substr(0,8)!=q)return a.reject("Invalid PNG file signature"),a.promise();var e,g="",h="",f=!1,k=8,j=null;do{var i=
l(b.substr(k,4)),p=b.substr(k+4,4),n;switch(p){case "IHDR":e=n=b.substr(k+8,i);this.width=l(n.substr(0,4));this.height=l(n.substr(4,4));break;case "acTL":f=!0;this.numPlays=l(b.substr(k+8+4,4));break;case "fcTL":j&&this.frames.push(j);n=b.substr(k+8,i);j={};j.width=l(n.substr(4,4));j.height=l(n.substr(8,4));j.left=l(n.substr(12,4));j.top=l(n.substr(16,4));var w=d(n.substr(20,2)),r=d(n.substr(22,2));r==0&&(r=100);j.delay=1E3*w/r;this.playTime+=j.delay;j.disposeOp=n.charCodeAt(24);j.blendOp=n.charCodeAt(25);
j.dataParts=[];break;case "fdAT":j&&j.dataParts.push(b.substr(k+8+4,i-4));break;case "IDAT":j&&j.dataParts.push(b.substr(k+8,i));break;case "IEND":h=b.substr(k,i+12);break;default:g+=b.substr(k,i+12)}k+=12+i}while(p!="IEND"&&k<b.length);j&&this.frames.push(j);if(!f)return a.reject("Non-animated PNG"),a.promise();for(var v=0,s=this,b=0;b<this.frames.length;b++){f=new Image;j=this.frames[b];j.img=f;f.onload=function(){v++;v==s.frames.length&&a.resolve(this)};f.onerror=function(){a.reject("Image creation error")};
k=new t;k.append(q);e=o(j.width)+o(j.height)+e.substr(8);k.append(m("IHDR",e));k.append(g);for(i=0;i<j.dataParts.length;i++)k.append(m("IDAT",j.dataParts[i]));k.append(h);f.src=k.getUrl("image/png");delete j.dataParts}return a.promise()};var e=[];this.addCanvas=function(){var a=document.createElement("canvas");a.width=this.width;a.height=this.height;var b=a.getContext("2d");e.push(b);e.length>1&&b.putImageData(e[0].getImageData(0,0,this.width,this.height),0,0);this.isActive=!0;return a};var b=0,g=
null,h=function(a,b){for(var c=0;c<e.length;c++)e[c][a].apply(e[c],b)};this.renderFrame=function(a){if(e.length!=0){var c=b++%this.frames.length,d=this.frames[c];if(c==0&&(h("clearRect",[0,0,this.width,this.height]),g=null,d.disposeOp==2))d.disposeOp=1;g&&g.disposeOp==1?h("clearRect",[g.left,g.top,g.width,g.height]):g&&g.disposeOp==2&&h("putImageData",[g.iData,g.left,g.top]);g=d;g.iData=null;if(g.disposeOp==2)g.iData=e[0].getImageData(d.left,d.top,d.width,d.height);d.blendOp==0&&h("clearRect",[d.left,
d.top,d.width,d.height]);h("drawImage",[d.img,d.left,d.top]);if(this.numPlays==0||b/this.frames.length<this.numPlays){if(this.nextRenderTime==0)this.nextRenderTime=a;for(;a>this.nextRenderTime+this.playTime;)this.nextRenderTime+=this.playTime;this.nextRenderTime+=d.delay}else this.isActive=!1}}},y=function(c){var d=new Deferred,b=new XMLHttpRequest,e=a.BlobBuilder||a.WebKitBlobBuilder,h=typeof b.responseBody!="undefined",i=typeof b.responseType!="undefined"&&typeof e!="undefined",f=typeof b.overrideMimeType!=
"undefined"&&!i;b.open("GET",c,!0);i?b.responseType="arraybuffer":f&&b.overrideMimeType("text/plain; charset=x-user-defined");b.onreadystatechange=function(){if(this.readyState==4&&this.status==200)if(i){var a=new e;a.append(this.response);var c=new FileReader;c.onload=function(){d.resolve(this.result)};c.readAsBinaryString(a.getBlob())}else{a="";if(h)for(var c=APNGIEBinaryToBinStr(this.responseBody),f=0,k=c.length;f<k;f++){var j=c.charCodeAt(f);a+=String.fromCharCode(j&255,j>>8&255)}else{c=this.responseText;
f=0;for(k=c.length;f<k;++f)a+=String.fromCharCode(c.charCodeAt(f)&255)}d.resolve(a)}else this.readyState==4&&d.reject(b)};b.send();return d.promise()}})();
