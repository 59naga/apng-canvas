(function(){var j=function(){return this}();j.Deferred=typeof j.jQuery!=="undefined"&&typeof j.jQuery.Deferred!=="undefined"?j.jQuery.Deferred:function(){if(!(this instanceof arguments.callee))return new j.Deferred;var l=[0,[],[]],f=0,i,g=null,d,p=this,q=function(c,d,g){if(!f){f=c;i=d;for(c=l[c];c.length;)c.shift().apply(g,i);l=null;return p}},r=function(c,d){f==c?d.apply(this,i):f||l[c].push(d);return this};p.promise=function(c){if(!c&&g)return g;g=c?c:g?g:{};for(var f in d)d.hasOwnProperty(f)&&
(g[f]=d[f]);return g};p.resolve=function(){return q(1,arguments,g)};p.reject=function(){return q(2,arguments,g)};p.resolveWith=function(){var c=arguments.shift();return q(1,arguments,c)};p.rejectWith=function(){var c=arguments.shift();return q(2,arguments,c)};d={done:function(c){return r.call(this,1,c)},fail:function(c){return r.call(this,2,c)},then:function(c,d){return this.done(c).fail(d)},always:function(c){return this.then(c,c)},isResolved:function(){return f==1},isRejected:function(){return f==
2}}}})();(function(){for(var j=function(){return this}(),l=Array(256),f=0;f<256;f++){for(var i=f,g=0;g<8;g++)i=i&1?3988292384^i>>>1:i>>>1;l[f]=i}j.crc32=function(d){for(var f=-1,g=0,i=d.length;g<i;g++)f=f>>>8^l[(f^d.charCodeAt(g))&255];return f^-1}})();(function(){var j=function(){return this}(),l=j.APNG={},f=null;l.checkNativeFeatures=function(a){var o=!f,b=o?f=new Deferred:f;a&&b.promise().done(a);if(!o)return b.promise();var c={canvas:!1,apng:!1},m=document.createElement("canvas");if(typeof m.getContext=="undefined")b.resolve(c);else{c.canvas=!0;var d=new Image;d.onload=function(){var a=m.getContext("2d");a.drawImage(d,0,0);if(a.getImageData(0,0,1,1).data[3]===0)c.apng=!0;b.resolve(c)};d.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACGFjVEwAAAABAAAAAcMq2TYAAAANSURBVAiZY2BgYPgPAAEEAQB9ssjfAAAAGmZjVEwAAAAAAAAAAQAAAAEAAAAAAAAAAAD6A+gBAbNU+2sAAAARZmRBVAAAAAEImWNgYGBgAAAABQAB6MzFdgAAAABJRU5ErkJggg=="}return b.promise()};
var i=null;l.ifNeeded=function(a){var c=!i,b=c?i=new Deferred:i;a&&b.promise().done(a);if(!c)return b.promise();if(location.protocol!="http:"&&location.protocol!="https:")return b.reject("apng-canvas doesn't work on pages loaded by '"+location.protocol+"' protocol"),b.promise();this.checkNativeFeatures().done(function(a){a.canvas&&!a.apng?b.resolve():(a.canvas||b.reject("Browser doesn't support canvas"),a.apng&&b.reject("Browser has native APNG support"))}).done(function(){b.reject()});return b.promise()};
l.createAPNGCanvas=function(a,o){var b=new Deferred;o&&b.promise().done(o);s(a).done(function(a){v(a).done(function(m){var o=document.createElement("canvas");o.width=m.width;o.height=m.height;if(m.isAnimated)w(m,o);else{var d=new Image;d.onload=function(){o.getContext("2d").drawImage(d,0,0)};m=new c;m.append(a);d.src=m.getUrl("image/png")}b.resolve(o)}).fail(function(a){b.reject(a)})}).fail(function(a){b.reject(a)});return b.promise()};l.replaceImage=function(a){console.log(a.src,a.complete,a.readyState);
return l.createAPNGCanvas(a.src).done(function(c){a.parentNode.insertBefore(c,a);a.parentNode.removeChild(a)})};var g=String.fromCharCode(137,80,78,71,13,10,26,10),d=function(a){for(var c=0,b=0;b<4;b++)c+=a.charCodeAt(b)<<(3-b)*8;return c},p=function(a){for(var c=0,b=0;b<2;b++)c+=a.charCodeAt(b)<<(1-b)*8;return c},q=function(a,c){var b="";b+=r(c.length);b+=a;b+=c;b+=r(crc32(a+c));return b},r=function(a){return String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,a&255)},c=function(){this.parts=[]};c.prototype.append=
function(a){this.parts.push(a)};c.prototype.getUrl=function(a){return"data:"+a+","+escape(this.parts.join(""))};typeof XMLHttpRequest.prototype.responseBody!="undefined"&&typeof document.addEventListener!="undefined"&&document.addEventListener("DOMContentLoaded",function(){var a=document.createElement("script");a.setAttribute("type","text/vbscript");a.text="Function APNGIEBinaryToBinStr(Binary)\r\n   APNGIEBinaryToBinStr = CStr(Binary)\r\nEnd Function\r\n";document.body.appendChild(a)});var s=function(a){var c=
new Deferred,b=new XMLHttpRequest,d=j.BlobBuilder||j.WebKitBlobBuilder,m=typeof this.responseBody!="undefined",f=typeof this.responseType!="undefined"&&typeof d!="undefined",g=typeof b.overrideMimeType!="undefined"&&!f;b.open("GET",a,!0);f?b.responseType="arraybuffer":g&&b.overrideMimeType("text/plain; charset=x-user-defined");b.onreadystatechange=function(){if(this.readyState==4&&this.status==200)if(f){var a=new d;a.append(this.response);var g=new FileReader;g.onload=function(){c.resolve(this.result)};
g.readAsBinaryString(a.getBlob())}else{a="";if(m)for(var g=APNGIEBinaryToBinStr(this.responseBody),h=0,k=g.length;h<k;h++){var i=g.charCodeAt(h);a+=String.fromCharCode(i&255,i>>8&255)}else{g=this.responseText;h=0;for(k=g.length;h<k;++h)a+=String.fromCharCode(g.charCodeAt(h)&255)}c.resolve(a)}else this.readyState==4&&c.reject(b)};b.send();return c.promise()},v=function(a){var f=new Deferred;if(a.substr(0,8)!=g)return f.reject("Invalid PNG file signature"),f.promise();var b={width:0,height:0,isAnimated:!1,
numPlays:0,frames:[]},i,m="",l="",h=8,e=null;do{var n=d(a.substr(h,4)),j=a.substr(h+4,4),k;switch(j){case "IHDR":i=k=a.substr(h+8,n);b.width=d(k.substr(0,4));b.height=d(k.substr(4,4));break;case "acTL":b.isAnimated=!0;b.numPlays=d(a.substr(h+8+4,4));break;case "fcTL":e&&b.frames.push(e);k=a.substr(h+8,n);e={};e.width=d(k.substr(4,4));e.height=d(k.substr(8,4));e.left=d(k.substr(12,4));e.top=d(k.substr(16,4));var s=p(k.substr(20,2)),t=p(k.substr(22,2));t==0&&(t=100);e.delay=1E3*s/t;e.disposeOp=k.charCodeAt(24);
e.blendOp=k.charCodeAt(25);e.dataParts=[];break;case "fdAT":e&&e.dataParts.push(a.substr(h+8+4,n-4));break;case "IDAT":e&&e.dataParts.push(a.substr(h+8,n));break;case "IEND":l=a.substr(h,n+12);break;default:m+=a.substr(h,n+12)}h+=12+n}while(j!="IEND"&&h<a.length);e&&b.frames.push(e);b.isAnimated||f.resolve(b);for(var u=0,a=0;a<b.frames.length;a++){h=new Image;e=b.frames[a];e.img=h;h.onload=function(){u++;u==b.frames.length&&f.resolve(b)};h.onerror=function(){f.reject("Image creation error")};n=new c;
n.append(g);i=r(e.width)+r(e.height)+i.substr(8);n.append(q("IHDR",i));n.append(m);for(j=0;j<e.dataParts.length;j++)n.append(q("IDAT",e.dataParts[j]));n.append(l);h.src=n.getUrl("image/png");delete e.dataParts}return f.promise()},w=function(a,c){var b=c.getContext("2d"),f=0,d=null,g=function(){var c=f++%a.frames.length,e=a.frames[c];if(c==0&&(b.clearRect(0,0,a.width,a.height),d=null,e.disposeOp==2))e.disposeOp=1;d&&d.disposeOp==1?b.clearRect(d.left,d.top,d.width,d.height):d&&d.disposeOp==2&&b.putImageData(d.iData,
d.left,d.top);d=e;d.iData=null;if(d.disposeOp==2)d.iData=b.getImageData(e.left,e.top,e.width,e.height);e.blendOp==0&&b.clearRect(e.left,e.top,e.width,e.height);b.drawImage(e.img,e.left,e.top);(a.numPlays==0||f/a.frames.length<a.numPlays)&&setTimeout(g,e.delay)};g()}})();
