// Input 0
/*

 uDeferred library

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @license http://creativecommons.org/licenses/by/3.0/
*/
(function(){var a=function(){return this}(),f;f=typeof a.jQuery!=="undefined"&&typeof a.jQuery.Deferred!=="undefined"?a.Deferred=a.jQuery.Deferred:a.Deferred=function(){if(!(this instanceof arguments.callee))return new f;var h=[0,[],[]],a=0,o,e=null,n,m=this,i=function(k,e,n){if(!a){a=k;o=e;for(k=h[k];k.length;)k.shift().apply(n,o);h=null;return m}},t=function(k,e){a==k?e.apply(this,o):a||h[k].push(e);return this};m.promise=function(k){if(!k&&e)return e;e=k?k:e?e:{};for(var a in n)n.hasOwnProperty(a)&&
(e[a]=n[a]);return e};m.resolve=function(){return i(1,arguments,e)};m.reject=function(){return i(2,arguments,e)};m.resolveWith=function(){var k=Array.prototype.slice.call(arguments),a=k.shift();return i(1,k,a)};m.rejectWith=function(){var a=Array.prototype.slice.call(arguments),e=a.shift();return i(2,a,e)};n={done:function(a){return t.call(this,1,a)},fail:function(a){return t.call(this,2,a)},then:function(a,e){return this.done(a).fail(e)},always:function(a){return this.then(a,a)},isResolved:function(){return a==
1},isRejected:function(){return a==2},promise:function(){return this}}};var i=function(a,i){return function(){return a.apply(i,arguments)}};f.pipeline=function(){var a,p=arguments,o,e=function(){if(o.length){var n=o.shift().apply(null,arguments);typeof n.promise=="function"?n.promise().then(e,i(a.reject,a)):e.apply(null,[n])}else a.resolve.apply(a,arguments)};return function(){a=new f;o=Array.prototype.slice.call(arguments);e.apply(null,p);return a.promise()}}})();
// Input 1
/*

 CRC32

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @license http://creativecommons.org/licenses/by/3.0/
*/
(function(){for(var a=function(){return this}(),f=Array(256),i=0;i<256;i++){for(var h=i,p=0;p<8;p++)h=h&1?3988292384^h>>>1:h>>>1;f[i]=h}a.crc32=function(a){for(var e=-1,h=0,m=a.length;h<m;h++)e=e>>>8^f[(e^a.charCodeAt(h))&255];return e^-1}})();
// Input 2
/*

 APNG-canvas

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @link https://github.com/davidmz/apng-canvas
 @license https://github.com/davidmz/apng-canvas/blob/master/LICENSE (MIT License)
*/
(function(){var a=function(){return this}(),f=a.jQuery||null,i=!!document.getCSSCanvasContext,h=a.APNG={},p=null;h.checkNativeFeatures=function(c){var d=!p,b=d?p=new Deferred:p;c&&b.promise().done(c);if(!d)return b.promise();var a={canvas:!1,apng:!1},e=document.createElement("canvas");if(typeof e.getContext=="undefined")b.resolve(a);else{a.canvas=!0;var g=new Image;g.onload=function(){var c=e.getContext("2d");c.drawImage(g,0,0);if(c.getImageData(0,0,1,1).data[3]===0)a.apng=!0;b.resolve(a)};g.src=
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACGFjVEwAAAABAAAAAcMq2TYAAAANSURBVAiZY2BgYPgPAAEEAQB9ssjfAAAAGmZjVEwAAAAAAAAAAQAAAAEAAAAAAAAAAAD6A+gBAbNU+2sAAAARZmRBVAAAAAEImWNgYGBgAAAABQAB6MzFdgAAAABJRU5ErkJggg=="}return b.promise()};var o=null;h.ifNeeded=function(c){var a=!o,b=a?o=new Deferred:o;c&&b.promise().done(c);if(!a)return b.promise();if(location.protocol!="http:"&&location.protocol!="https:")return b.reject("apng-canvas doesn't work on pages loaded by '"+location.protocol+
"' protocol"),b.promise();this.checkNativeFeatures().done(function(c){c.canvas&&!c.apng?b.resolve():(c.canvas||b.reject("Browser doesn't support canvas"),c.apng&&b.reject("Browser has native APNG support"))}).done(function(){b.reject()});return b.promise()};h.createAPNGCanvas=function(c,a){var b=new Deferred;a&&b.promise().done(a);s.createFromUrl(c).done(function(){b.resolve(this.addCanvas())}).fail(r(b.reject,b));return b.promise()};h.animateImage=function(c){if(i){var d=new Deferred;c.hasAttribute("data-is-apng")?
d.reject("Image already animated"):(c.setAttribute("data-is-apng","progress"),s.createFromUrl(c.src).done(function(){var b=this.getCSSCanvasContextName();if(!c.hasAttribute("width")&&!c.style.width)c.style.width=a.getComputedStyle(c).width;if(!c.hasAttribute("height")&&!c.style.height)c.style.height=a.getComputedStyle(c).height;c.setAttribute("data-is-apng","yes");c.style.content="-webkit-canvas("+b+")";d.resolve()}).fail(function(){c.setAttribute("data-is-apng","no")}).fail(r(d.reject,d)));return d.promise()}else return this.replaceImage(c)};
h.replaceImage=function(c){if(c.hasAttribute("data-is-apng")){var a=new Deferred;a.reject("Image already animated");return a.promise()}else return c.setAttribute("data-is-apng","progress"),h.createAPNGCanvas(c.src).done(function(a){for(var d=0;d<c.attributes.length;d++){var e=c.attributes[d];["alt","src","usemap","ismap"].indexOf(e.nodeName)==-1&&a.setAttributeNode(e.cloneNode())}a.setAttribute("data-apng-src",c.src);if(f&&(d=f(c).data("events")))for(var g in d)for(var e=0,h=d[g].length;e<h;e++){var u=
d[g][e];f(a).bind(g+(u.namespace?".":"")+u.namespace,u.data,u.handler)}g=c.parentNode;g.insertBefore(a,c);g.removeChild(c)}).fail(function(){c.setAttribute("data-is-apng","no")})};var e=String.fromCharCode(137,80,78,71,13,10,26,10),n=1,m=function(c){for(var a=0,b=0;b<4;b++)a+=c.charCodeAt(b)<<(3-b)*8;return a},A=function(c){for(var a=0,b=0;b<2;b++)a+=c.charCodeAt(b)<<(1-b)*8;return a},t=function(c,a){var b="";b+=k(a.length);b+=c;b+=a;b+=k(crc32(c+a));return b},k=function(a){return String.fromCharCode(a>>
24&255,a>>16&255,a>>8&255,a&255)},x=function(){this.parts=[]};x.prototype.append=function(a){this.parts.push(a)};x.prototype.getUrl=function(c){return a.btoa?"data:"+c+";base64,"+btoa(this.parts.join("")):"data:"+c+","+escape(this.parts.join(""))};var r=function(a,d){return function(){return a.apply(d,arguments)}};typeof XMLHttpRequest.prototype.responseBody!="undefined"&&typeof document.addEventListener!="undefined"&&document.addEventListener("DOMContentLoaded",function(){var a=document.createElement("script");
a.setAttribute("type","text/vbscript");a.text="Function APNGIEBinaryToBinStr(Binary)\r\n   APNGIEBinaryToBinStr = CStr(Binary)\r\nEnd Function\r\n";document.body.appendChild(a)});var v=[];(function(){if(v.length)for(var a=v.splice(0,v.length),d=(new Date).getTime();a.length;)a.shift().call(null,d);setTimeout(arguments.callee,1E3/60)})();var w=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||function(a){v.push(a)},B=function(a){for(var d=
0;d<y.length;d++)for(var b=y[d];b.isActive&&b.nextRenderTime<=a;)b.renderFrame(a);w(B)};w(B);var s=function(){var a=this;this.isActive=!1;this.numPlays=this.height=this.width=this.nextRenderTime=0;this.frames=[];this.playTime=0;var d=new Deferred;this.whenReady=r(d.promise,d);this.parsePNGData=function(b){if(b.substr(0,8)!=e)return d.reject("Invalid PNG file signature"),d.promise();var g,C="",h="",i=!1,l=8,j=null;do{var f=m(b.substr(l,4)),n=b.substr(l+4,4),q;switch(n){case "IHDR":g=q=b.substr(l+8,
f);this.width=m(q.substr(0,4));this.height=m(q.substr(4,4));break;case "acTL":i=!0;this.numPlays=m(b.substr(l+8+4,4));break;case "fcTL":j&&this.frames.push(j);q=b.substr(l+8,f);j={};j.width=m(q.substr(4,4));j.height=m(q.substr(8,4));j.left=m(q.substr(12,4));j.top=m(q.substr(16,4));var o=A(q.substr(20,2)),p=A(q.substr(22,2));p==0&&(p=100);j.delay=1E3*o/p;if(j.delay<=10)j.delay=100;this.playTime+=j.delay;j.disposeOp=q.charCodeAt(24);j.blendOp=q.charCodeAt(25);j.dataParts=[];break;case "fdAT":j&&j.dataParts.push(b.substr(l+
8+4,f-4));break;case "IDAT":j&&j.dataParts.push(b.substr(l+8,f));break;case "IEND":h=b.substr(l,f+12);break;default:C+=b.substr(l,f+12)}l+=12+f}while(n!="IEND"&&l<b.length);j&&this.frames.push(j);if(!i)return d.reject("Non-animated PNG"),d.promise();for(var r=0,s=this,b=0;b<this.frames.length;b++){i=new Image;j=this.frames[b];j.img=i;i.onload=function(){r++;r==s.frames.length&&d.resolveWith(a)};i.onerror=function(){d.reject("Image creation error")};l=new x;l.append(e);g=k(j.width)+k(j.height)+g.substr(8);
l.append(t("IHDR",g));l.append(C);for(f=0;f<j.dataParts.length;f++)l.append(t("IDAT",j.dataParts[f]));l.append(h);i.src=l.getUrl("image/png");delete j.dataParts}return d.promise()};var b=[];this.addCanvas=function(){var a=document.createElement("canvas");a.width=this.width;a.height=this.height;var c=a.getContext("2d");b.push(c);b.length>1&&w(function(){c.putImageData(b[0].getImageData(0,0,a.width,a.height),0,0)});this.isActive=!0;return a};var h=null;this.getCSSCanvasContextName=function(){if(!h){h=
"apng-canvas-css-"+n++;var d=document.getCSSCanvasContext("2d",h,this.width,this.height);b.push(d);b.length>1&&w(function(){d.putImageData(b[0].getImageData(0,0,a.width,a.height),0,0)});this.isActive=!0}return h};var i=0,g=null,f=function(a,c){for(var d=0;d<b.length;d++)b[d][a].apply(b[d],c)};this.renderFrame=function(a){if(b.length!=0){var c=i++%this.frames.length,d=this.frames[c];if(c==0&&(f("clearRect",[0,0,this.width,this.height]),g=null,d.disposeOp==2))d.disposeOp=1;g&&g.disposeOp==1?f("clearRect",
[g.left,g.top,g.width,g.height]):g&&g.disposeOp==2&&f("putImageData",[g.iData,g.left,g.top]);g=d;g.iData=null;if(g.disposeOp==2)g.iData=b[0].getImageData(d.left,d.top,d.width,d.height);d.blendOp==0&&f("clearRect",[d.left,d.top,d.width,d.height]);f("drawImage",[d.img,d.left,d.top]);if(this.numPlays==0||i/this.frames.length<this.numPlays){if(this.nextRenderTime==0)this.nextRenderTime=a;for(;a>this.nextRenderTime+this.playTime;)this.nextRenderTime+=this.playTime;this.nextRenderTime+=d.delay}else this.isActive=
!1}}},D=function(c){var d=new Deferred,b=new XMLHttpRequest,e=a.BlobBuilder||a.WebKitBlobBuilder,h=typeof b.responseBody!="undefined",g=typeof b.responseType!="undefined"&&typeof e!="undefined",f=typeof b.overrideMimeType!="undefined"&&!g;b.open("GET",c,!0);g?b.responseType="arraybuffer":f&&b.overrideMimeType("text/plain; charset=x-user-defined");b.onreadystatechange=function(){if(this.readyState==4&&this.status==200)if(g){var a=new e;a.append(this.response);var c=new FileReader;c.onload=function(){d.resolve(this.result)};
c.readAsBinaryString(a.getBlob())}else{a="";if(h)for(var c=APNGIEBinaryToBinStr(this.responseBody),f=0,i=c.length;f<i;f++){var k=c.charCodeAt(f);a+=String.fromCharCode(k&255,k>>8&255)}else{c=this.responseText;f=0;for(i=c.length;f<i;++f)a+=String.fromCharCode(c.charCodeAt(f)&255)}d.resolve(a)}else this.readyState==4&&d.reject(b)};b.send();return d.promise()},y=[],z={};s.createFromUrl=function(a){var d;a in z?d=z[a]:(d=new s,z[a]=d,y.push(d),Deferred.pipeline(a)(D,r(d.parsePNGData,d)));return d.whenReady()}})();
