// Input 0
/*

 uDeferred library

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @license http://creativecommons.org/licenses/by/3.0/
*/
(function(){var b=function(){return this}(),k;k=typeof b.jQuery!=="undefined"&&typeof b.jQuery.Deferred!=="undefined"?b.Deferred=b.jQuery.Deferred:b.Deferred=function(){if(!(this instanceof arguments.callee))return new k;var f=[0,[],[]],b=0,o,a=null,l,e=this,p=function(h,a,l){if(!b){b=h;o=a;for(h=f[h];h.length;)h.shift().apply(l,o);f=null;return e}},r=function(a,e){b==a?e.apply(this,o):b||f[a].push(e);return this};e.promise=function(h){if(!h&&a)return a;a=h?h:a?a:{};for(var b in l)l.hasOwnProperty(b)&&
(a[b]=l[b]);return a};e.resolve=function(){return p(1,arguments,a)};e.reject=function(){return p(2,arguments,a)};e.resolveWith=function(){var a=arguments.shift();return p(1,arguments,a)};e.rejectWith=function(){var a=arguments.shift();return p(2,arguments,a)};l={done:function(a){return r.call(this,1,a)},fail:function(a){return r.call(this,2,a)},then:function(a,b){return this.done(a).fail(b)},always:function(a){return this.then(a,a)},isResolved:function(){return b==1},isRejected:function(){return b==
2},promise:function(){return this}}};var e=function(b,e){return function(){return b.apply(e,arguments)}};k.pipeline=function(){var b,n=arguments,o,a=function(){if(o.length){var l=o.shift().apply(null,arguments);typeof l.promise=="function"?l.promise().then(a,e(b.reject,b)):a.apply(null,[l])}else b.resolve.apply(b,arguments)};return function(){b=new k;o=Array.prototype.slice.call(arguments);a.apply(null,n);return b.promise()}}})();
// Input 1
/*

 CRC32

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @license http://creativecommons.org/licenses/by/3.0/
*/
(function(){for(var b=function(){return this}(),k=Array(256),e=0;e<256;e++){for(var f=e,n=0;n<8;n++)f=f&1?3988292384^f>>>1:f>>>1;k[e]=f}b.crc32=function(b){for(var a=-1,e=0,f=b.length;e<f;e++)a=a>>>8^k[(a^b.charCodeAt(e))&255];return a^-1}})();
// Input 2
/*

 APNG-canvas

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @link https://github.com/davidmz/apng-canvas
 @license https://github.com/davidmz/apng-canvas/blob/master/LICENSE (MIT License)
*/
(function(){var b=function(){return this}(),k=b.jQuery||null,e=b.APNG={},f=null;e.checkNativeFeatures=function(d){var a=!f,c=a?f=new Deferred:f;d&&c.promise().done(d);if(!a)return c.promise();var i={canvas:!1,apng:!1},b=document.createElement("canvas");if(typeof b.getContext=="undefined")c.resolve(i);else{i.canvas=!0;var t=new Image;t.onload=function(){var d=b.getContext("2d");d.drawImage(t,0,0);if(d.getImageData(0,0,1,1).data[3]===0)i.apng=!0;c.resolve(i)};t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACGFjVEwAAAABAAAAAcMq2TYAAAANSURBVAiZY2BgYPgPAAEEAQB9ssjfAAAAGmZjVEwAAAAAAAAAAQAAAAEAAAAAAAAAAAD6A+gBAbNU+2sAAAARZmRBVAAAAAEImWNgYGBgAAAABQAB6MzFdgAAAABJRU5ErkJggg=="}return c.promise()};
var n=null;e.ifNeeded=function(d){var a=!n,c=a?n=new Deferred:n;d&&c.promise().done(d);if(!a)return c.promise();if(location.protocol!="http:"&&location.protocol!="https:")return c.reject("apng-canvas doesn't work on pages loaded by '"+location.protocol+"' protocol"),c.promise();this.checkNativeFeatures().done(function(d){d.canvas&&!d.apng?c.resolve():(d.canvas||c.reject("Browser doesn't support canvas"),d.apng&&c.reject("Browser has native APNG support"))}).done(function(){c.reject()});return c.promise()};
e.createAPNGCanvas=function(d,a){var c=new Deferred;a&&c.promise().done(a);var b;d in s?b=s[d]:(b=new y,s[d]=b,q.push(b),Deferred.pipeline(d)(z,h(b.parsePNGData,b)));b.whenReady().done(function(){var d=b.addCanvas();c.resolve(d)}).fail(h(c.reject,c));return c.promise()};e.replaceImage=function(d){return e.createAPNGCanvas(d.src).done(function(b){for(var c=0;c<d.attributes.length;c++){var a=d.attributes[c];["alt","src","usemap","ismap"].indexOf(a.nodeName)==-1&&b.setAttributeNode(a.cloneNode())}if(k&&
(c=k(d).data("events")))for(var e in c)for(var a=0,t=c[e].length;a<t;a++){var u=c[e][a];k(b).bind(e+(u.namespace?".":"")+u.namespace,u.data,u.handler)}e=d.parentNode;e.insertBefore(b,d);e.removeChild(d)})};var o=String.fromCharCode(137,80,78,71,13,10,26,10),a=function(d){for(var a=0,c=0;c<4;c++)a+=d.charCodeAt(c)<<(3-c)*8;return a},l=function(d){for(var a=0,c=0;c<2;c++)a+=d.charCodeAt(c)<<(1-c)*8;return a},w=function(d,a){var c="";c+=p(a.length);c+=d;c+=a;c+=p(crc32(d+a));return c},p=function(a){return String.fromCharCode(a>>
24&255,a>>16&255,a>>8&255,a&255)},r=function(){this.parts=[]};r.prototype.append=function(a){this.parts.push(a)};r.prototype.getUrl=function(a){return b.btoa?"data:"+a+";base64,"+btoa(this.parts.join("")):"data:"+a+","+escape(this.parts.join(""))};var h=function(a,b){return function(){return a.apply(b,arguments)}};typeof XMLHttpRequest.prototype.responseBody!="undefined"&&typeof document.addEventListener!="undefined"&&document.addEventListener("DOMContentLoaded",function(){var a=document.createElement("script");
a.setAttribute("type","text/vbscript");a.text="Function APNGIEBinaryToBinStr(Binary)\r\n   APNGIEBinaryToBinStr = CStr(Binary)\r\nEnd Function\r\n";document.body.appendChild(a)});var q=[],s={},A=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||function(a){setTimeout(a,1E3/60)};(function(){for(var a=(new Date).getTime(),b=0;b<q.length;b++)for(var c=q[b];c.isActive&&c.nextRenderTime<=a;)c.renderFrame(a);A(arguments.callee)})();var y=function(){this.isActive=
!1;this.numPlays=this.height=this.width=this.nextRenderTime=0;this.frames=[];this.playTime=0;var b=new Deferred;this.whenReady=h(b.promise,b);this.parsePNGData=function(c){if(c.substr(0,8)!=o)return b.reject("Invalid PNG file signature"),b.promise();var e,x="",i="",f=!1,j=8,g=null;do{var h=a(c.substr(j,4)),k=c.substr(j+4,4),m;switch(k){case "IHDR":e=m=c.substr(j+8,h);this.width=a(m.substr(0,4));this.height=a(m.substr(4,4));break;case "acTL":f=!0;this.numPlays=a(c.substr(j+8+4,4));break;case "fcTL":g&&
this.frames.push(g);m=c.substr(j+8,h);g={};g.width=a(m.substr(4,4));g.height=a(m.substr(8,4));g.left=a(m.substr(12,4));g.top=a(m.substr(16,4));var n=l(m.substr(20,2)),v=l(m.substr(22,2));v==0&&(v=100);g.delay=1E3*n/v;this.playTime+=g.delay;g.disposeOp=m.charCodeAt(24);g.blendOp=m.charCodeAt(25);g.dataParts=[];break;case "fdAT":g&&g.dataParts.push(c.substr(j+8+4,h-4));break;case "IDAT":g&&g.dataParts.push(c.substr(j+8,h));break;case "IEND":i=c.substr(j,h+12);break;default:x+=c.substr(j,h+12)}j+=12+
h}while(k!="IEND"&&j<c.length);g&&this.frames.push(g);if(!f)return b.reject("Non-animated PNG"),b.promise();for(var q=0,s=this,c=0;c<this.frames.length;c++){f=new Image;g=this.frames[c];g.img=f;f.onload=function(){q++;q==s.frames.length&&b.resolve(this)};f.onerror=function(){b.reject("Image creation error")};j=new r;j.append(o);e=p(g.width)+p(g.height)+e.substr(8);j.append(w("IHDR",e));j.append(x);for(h=0;h<g.dataParts.length;h++)j.append(w("IDAT",g.dataParts[h]));j.append(i);f.src=j.getUrl("image/png");
delete g.dataParts}return b.promise()};var e=[];this.addCanvas=function(){var a=document.createElement("canvas");a.width=this.width;a.height=this.height;var c=a.getContext("2d");e.push(c);e.length>1&&c.putImageData(e[0].getImageData(0,0,this.width,this.height),0,0);this.isActive=!0;return a};var c=0,i=null,f=function(a,c){for(var b=0;b<e.length;b++)e[b][a].apply(e[b],c)};this.renderFrame=function(a){if(e.length!=0){var b=c++%this.frames.length,d=this.frames[b];if(b==0&&(f("clearRect",[0,0,this.width,
this.height]),i=null,d.disposeOp==2))d.disposeOp=1;i&&i.disposeOp==1?f("clearRect",[i.left,i.top,i.width,i.height]):i&&i.disposeOp==2&&f("putImageData",[i.iData,i.left,i.top]);i=d;i.iData=null;if(i.disposeOp==2)i.iData=e[0].getImageData(d.left,d.top,d.width,d.height);d.blendOp==0&&f("clearRect",[d.left,d.top,d.width,d.height]);f("drawImage",[d.img,d.left,d.top]);if(this.numPlays==0||c/this.frames.length<this.numPlays){if(this.nextRenderTime==0)this.nextRenderTime=a;for(;a>this.nextRenderTime+this.playTime;)this.nextRenderTime+=
this.playTime;this.nextRenderTime+=d.delay}else this.isActive=!1}}},z=function(a){var e=new Deferred,c=new XMLHttpRequest,f=b.BlobBuilder||b.WebKitBlobBuilder,h=typeof c.responseBody!="undefined",k=typeof c.responseType!="undefined"&&typeof f!="undefined",l=typeof c.overrideMimeType!="undefined"&&!k;c.open("GET",a,!0);k?c.responseType="arraybuffer":l&&c.overrideMimeType("text/plain; charset=x-user-defined");c.onreadystatechange=function(){if(this.readyState==4&&this.status==200)if(k){var a=new f;
a.append(this.response);var b=new FileReader;b.onload=function(){e.resolve(this.result)};b.readAsBinaryString(a.getBlob())}else{a="";if(h)for(var b=APNGIEBinaryToBinStr(this.responseBody),d=0,j=b.length;d<j;d++){var g=b.charCodeAt(d);a+=String.fromCharCode(g&255,g>>8&255)}else{b=this.responseText;d=0;for(j=b.length;d<j;++d)a+=String.fromCharCode(b.charCodeAt(d)&255)}e.resolve(a)}else this.readyState==4&&e.reject(c)};c.send();return e.promise()}})();
