// Input 0
/*

 uDeferred library

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @license http://creativecommons.org/licenses/by/3.0/
*/
(function(){var e=function(){return this}(),m;m=typeof e.jQuery!=="undefined"&&typeof e.jQuery.Deferred!=="undefined"?e.Deferred=e.jQuery.Deferred:e.Deferred=function(){if(!(this instanceof arguments.callee))return new m;var a=[0,[],[]],e=0,n,h=null,f,p=this,o=function(k,h,f){if(!e){e=k;n=h;for(k=a[k];k.length;)k.shift().apply(f,n);a=null;return p}},g=function(k,h){e==k?h.apply(this,n):e||a[k].push(h);return this};p.promise=function(k){if(!k&&h)return h;h=k?k:h?h:{};for(var a in f)f.hasOwnProperty(a)&&
(h[a]=f[a]);return h};p.resolve=function(){return o(1,arguments,h)};p.reject=function(){return o(2,arguments,h)};p.resolveWith=function(){var a=arguments.shift();return o(1,arguments,a)};p.rejectWith=function(){var a=arguments.shift();return o(2,arguments,a)};f={done:function(a){return g.call(this,1,a)},fail:function(a){return g.call(this,2,a)},then:function(a,h){return this.done(a).fail(h)},always:function(a){return this.then(a,a)},isResolved:function(){return e==1},isRejected:function(){return e==
2},promise:function(){return this}}};var g=function(a,e){return function(){return a.apply(e,arguments)}};m.pipeline=function(){var a,e=arguments,n,h=function(){if(n.length){var e=n.shift().apply(null,arguments);typeof e.promise=="function"?e.promise().then(h,g(a.reject,a)):h.apply(null,[e])}else a.resolve.apply(a,arguments)};return function(){a=new m;n=Array.prototype.slice.call(arguments);h.apply(null,e);return a.promise()}}})();
// Input 1
/*

 CRC32

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @license http://creativecommons.org/licenses/by/3.0/
*/
(function(){for(var e=function(){return this}(),m=Array(256),g=0;g<256;g++){for(var a=g,r=0;r<8;r++)a=a&1?3988292384^a>>>1:a>>>1;m[g]=a}e.crc32=function(a){for(var e=-1,f=0,g=a.length;f<g;f++)e=e>>>8^m[(e^a.charCodeAt(f))&255];return e^-1}})();
// Input 2
/*

 APNG-canvas

 @author David Mzareulyan
 @copyright 2011 David Mzareulyan
 @link https://github.com/davidmz/apng-canvas
 @license https://github.com/davidmz/apng-canvas/blob/master/LICENSE (MIT License)
*/
(function(){var e=function(){return this}(),m=e.jQuery||null,g=!!document.getCSSCanvasContext,a=e.APNG={},r=null;a.checkNativeFeatures=function(b){var d=!r,c=d?r=new Deferred:r;b&&c.promise().done(b);if(!d)return c.promise();var a={canvas:!1,apng:!1},e=document.createElement("canvas");if(typeof e.getContext=="undefined")c.resolve(a);else{a.canvas=!0;var i=new Image;i.onload=function(){var b=e.getContext("2d");b.drawImage(i,0,0);if(b.getImageData(0,0,1,1).data[3]===0)a.apng=!0;c.resolve(a)};i.src=
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACGFjVEwAAAABAAAAAcMq2TYAAAANSURBVAiZY2BgYPgPAAEEAQB9ssjfAAAAGmZjVEwAAAAAAAAAAQAAAAEAAAAAAAAAAAD6A+gBAbNU+2sAAAARZmRBVAAAAAEImWNgYGBgAAAABQAB6MzFdgAAAABJRU5ErkJggg=="}return c.promise()};var n=null;a.ifNeeded=function(b){var d=!n,c=d?n=new Deferred:n;b&&c.promise().done(b);if(!d)return c.promise();if(location.protocol!="http:"&&location.protocol!="https:")return c.reject("apng-canvas doesn't work on pages loaded by '"+location.protocol+
"' protocol"),c.promise();this.checkNativeFeatures().done(function(b){b.canvas&&!b.apng?c.resolve():(b.canvas||c.reject("Browser doesn't support canvas"),b.apng&&c.reject("Browser has native APNG support"))}).done(function(){c.reject()});return c.promise()};a.createAPNGCanvas=function(b,d){var c=new Deferred;d&&c.promise().done(d);s.createFromUrl(b).done(function(){c.resolve(this.addCanvas())}).fail(u(c.reject,c));return c.promise()};a.animateImage=function(b){if(g){var d=new Deferred;b.hasAttribute("data-apng-src")?
d.reject("Image already animated"):s.createFromUrl(b.src).done(function(){var c=this.getCSSCanvasContextName();b.setAttribute("data-apng-src",b.src);b.src=f;b.style.backgroundImage="-webkit-canvas("+c+")";d.resolve()}).fail(u(d.reject,d));return d.promise()}else return this.replaceImage(b)};a.replaceImage=function(b){if(b.hasAttribute("data-apng-src")){var d=new Deferred;d.reject("Image already animated");return d.promise()}else return a.createAPNGCanvas(b.src).done(function(c){for(var d=0;d<b.attributes.length;d++){var a=
b.attributes[d];["alt","src","usemap","ismap"].indexOf(a.nodeName)==-1&&c.setAttributeNode(a.cloneNode());b.setAttribute("data-apng-src",b.src)}if(m&&(d=m(b).data("events")))for(var e in d)for(var a=0,h=d[e].length;a<h;a++){var v=d[e][a];m(c).bind(e+(v.namespace?".":"")+v.namespace,v.data,v.handler)}e=b.parentNode;e.insertBefore(c,b);e.removeChild(b)})};var h=String.fromCharCode(137,80,78,71,13,10,26,10),f="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",p=1,o=
function(b){for(var d=0,c=0;c<4;c++)d+=b.charCodeAt(c)<<(3-c)*8;return d},B=function(b){for(var d=0,c=0;c<2;c++)d+=b.charCodeAt(c)<<(1-c)*8;return d},k=function(b,d){var c="";c+=t(d.length);c+=b;c+=d;c+=t(crc32(b+d));return c},t=function(b){return String.fromCharCode(b>>24&255,b>>16&255,b>>8&255,b&255)},y=function(){this.parts=[]};y.prototype.append=function(b){this.parts.push(b)};y.prototype.getUrl=function(b){return e.btoa?"data:"+b+";base64,"+btoa(this.parts.join("")):"data:"+b+","+escape(this.parts.join(""))};
var u=function(b,d){return function(){return b.apply(d,arguments)}};typeof XMLHttpRequest.prototype.responseBody!="undefined"&&typeof document.addEventListener!="undefined"&&document.addEventListener("DOMContentLoaded",function(){var b=document.createElement("script");b.setAttribute("type","text/vbscript");b.text="Function APNGIEBinaryToBinStr(Binary)\r\n   APNGIEBinaryToBinStr = CStr(Binary)\r\nEnd Function\r\n";document.body.appendChild(b)});var w=[];(function(){if(w.length)for(var b=w.splice(0,
w.length),d=(new Date).getTime();b.length;)b.shift().call(null,d);setTimeout(arguments.callee,1E3/60)})();var x=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||function(b){w.push(b)},C=function(b){for(var d=0;d<z.length;d++)for(var c=z[d];c.isActive&&c.nextRenderTime<=b;)c.renderFrame(b);x(C)};x(C);var s=function(){var b=this;this.isActive=!1;this.numPlays=this.height=this.width=this.nextRenderTime=0;this.frames=[];this.playTime=0;var d=
new Deferred;this.whenReady=u(d.promise,d);this.parsePNGData=function(c){if(c.substr(0,8)!=h)return d.reject("Invalid PNG file signature"),d.promise();var a,e="",i="",g=!1,l=8,j=null;do{var f=o(c.substr(l,4)),m=c.substr(l+4,4),q;switch(m){case "IHDR":a=q=c.substr(l+8,f);this.width=o(q.substr(0,4));this.height=o(q.substr(4,4));break;case "acTL":g=!0;this.numPlays=o(c.substr(l+8+4,4));break;case "fcTL":j&&this.frames.push(j);q=c.substr(l+8,f);j={};j.width=o(q.substr(4,4));j.height=o(q.substr(8,4));
j.left=o(q.substr(12,4));j.top=o(q.substr(16,4));var n=B(q.substr(20,2)),p=B(q.substr(22,2));p==0&&(p=100);j.delay=1E3*n/p;this.playTime+=j.delay;j.disposeOp=q.charCodeAt(24);j.blendOp=q.charCodeAt(25);j.dataParts=[];break;case "fdAT":j&&j.dataParts.push(c.substr(l+8+4,f-4));break;case "IDAT":j&&j.dataParts.push(c.substr(l+8,f));break;case "IEND":i=c.substr(l,f+12);break;default:e+=c.substr(l,f+12)}l+=12+f}while(m!="IEND"&&l<c.length);j&&this.frames.push(j);if(!g)return d.reject("Non-animated PNG"),
d.promise();for(var r=0,s=this,c=0;c<this.frames.length;c++){g=new Image;j=this.frames[c];j.img=g;g.onload=function(){r++;r==s.frames.length&&d.resolveWith(b)};g.onerror=function(){d.reject("Image creation error")};l=new y;l.append(h);a=t(j.width)+t(j.height)+a.substr(8);l.append(k("IHDR",a));l.append(e);for(f=0;f<j.dataParts.length;f++)l.append(k("IDAT",j.dataParts[f]));l.append(i);g.src=l.getUrl("image/png");delete j.dataParts}return d.promise()};var c=[];this.addCanvas=function(){var b=document.createElement("canvas");
b.width=this.width;b.height=this.height;var a=b.getContext("2d");c.push(a);c.length>1&&x(function(){a.putImageData(c[0].getImageData(0,0,b.width,b.height),0,0)});this.isActive=!0;return b};var a=null;this.getCSSCanvasContextName=function(){if(!a){a="apng-canvas-css-"+p++;var d=document.getCSSCanvasContext("2d",a,this.width,this.height);c.push(d);c.length>1&&x(function(){d.putImageData(c[0].getImageData(0,0,b.width,b.height),0,0)});this.isActive=!0}return a};var e=0,i=null,g=function(b,a){for(var d=
0;d<c.length;d++)c[d][b].apply(c[d],a)};this.renderFrame=function(b){if(c.length!=0){var d=e++%this.frames.length,a=this.frames[d];if(d==0&&(g("clearRect",[0,0,this.width,this.height]),i=null,a.disposeOp==2))a.disposeOp=1;i&&i.disposeOp==1?g("clearRect",[i.left,i.top,i.width,i.height]):i&&i.disposeOp==2&&g("putImageData",[i.iData,i.left,i.top]);i=a;i.iData=null;if(i.disposeOp==2)i.iData=c[0].getImageData(a.left,a.top,a.width,a.height);a.blendOp==0&&g("clearRect",[a.left,a.top,a.width,a.height]);g("drawImage",
[a.img,a.left,a.top]);if(this.numPlays==0||e/this.frames.length<this.numPlays){if(this.nextRenderTime==0)this.nextRenderTime=b;for(;b>this.nextRenderTime+this.playTime;)this.nextRenderTime+=this.playTime;this.nextRenderTime+=a.delay}else this.isActive=!1}}},D=function(a){var d=new Deferred,c=new XMLHttpRequest,g=e.BlobBuilder||e.WebKitBlobBuilder,h=typeof c.responseBody!="undefined",i=typeof c.responseType!="undefined"&&typeof g!="undefined",f=typeof c.overrideMimeType!="undefined"&&!i;c.open("GET",
a,!0);i?c.responseType="arraybuffer":f&&c.overrideMimeType("text/plain; charset=x-user-defined");c.onreadystatechange=function(){if(this.readyState==4&&this.status==200)if(i){var a=new g;a.append(this.response);var b=new FileReader;b.onload=function(){d.resolve(this.result)};b.readAsBinaryString(a.getBlob())}else{a="";if(h)for(var b=APNGIEBinaryToBinStr(this.responseBody),e=0,f=b.length;e<f;e++){var k=b.charCodeAt(e);a+=String.fromCharCode(k&255,k>>8&255)}else{b=this.responseText;e=0;for(f=b.length;e<
f;++e)a+=String.fromCharCode(b.charCodeAt(e)&255)}d.resolve(a)}else this.readyState==4&&d.reject(c)};c.send();return d.promise()},z=[],A={};s.createFromUrl=function(a){var d;a in A?d=A[a]:(d=new s,A[a]=d,z.push(d),Deferred.pipeline(a)(D,u(d.parsePNGData,d)));return d.whenReady()}})();
