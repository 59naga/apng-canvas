(function(){var l=function(){return this}();l.Deferred=typeof l.jQuery!=="undefined"&&typeof l.jQuery.Deferred!=="undefined"?l.jQuery.Deferred:function(){if(!(this instanceof arguments.callee))return new l.Deferred;var h=[0,[],[]],d=0,i,b=null,o,n=this,j=function(e,b,j){if(!d){d=e;i=b;for(e=h[e];e.length;)e.shift().apply(j,i);h=null;return n}},p=function(e,b){d==e?b.apply(this,i):d||h[e].push(b);return this};n.promise=function(e){if(!e&&b)return b;b=e?e:b?b:{};for(var d in o)o.hasOwnProperty(d)&&
(b[d]=o[d]);return b};n.resolve=function(){return j(1,arguments,b)};n.reject=function(){return j(2,arguments,b)};n.resolveWith=function(){var e=arguments.shift();return j(1,arguments,e)};n.rejectWith=function(){var e=arguments.shift();return j(2,arguments,e)};o={done:function(e){return p.call(this,1,e)},fail:function(e){return p.call(this,2,e)},then:function(e,b){return this.done(e).fail(b)},always:function(b){return this.then(b,b)},isResolved:function(){return d==1},isRejected:function(){return d==
2}}}})();(function(){for(var l=function(){return this}(),h=Array(256),d=0;d<256;d++){for(var i=d,b=0;b<8;b++)i=i&1?3988292384^i>>>1:i>>>1;h[d]=i}l.crc32=function(b){for(var d=-1,j=0,i=b.length;j<i;j++)d=d>>>8^h[(d^b.charCodeAt(j))&255];return d^-1}})();(function(){var l=function(){return this}(),h=l.APNG={},d=null;h.checkNativeFeatures=function(a){var b=!d,c=b?d=new Deferred:d;a&&c.promise().done(a);if(!b)return c.promise();var r={canvas:!1,apng:!1},q=document.createElement("canvas");if(typeof q.getContext=="undefined")c.resolve(r);else{r.canvas=!0;var e=new Image;e.onload=function(){var a=q.getContext("2d");a.drawImage(e,0,0);if(a.getImageData(0,0,1,1).data[3]===0)r.apng=!0;c.resolve(r)};e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACGFjVEwAAAABAAAAAcMq2TYAAAANSURBVAiZY2BgYPgPAAEEAQB9ssjfAAAAGmZjVEwAAAAAAAAAAQAAAAEAAAAAAAAAAAD6A+gBAbNU+2sAAAARZmRBVAAAAAEImWNgYGBgAAAABQAB6MzFdgAAAABJRU5ErkJggg=="}return c.promise()};
var i=null;h.ifNeeded=function(a){var b=!i,c=b?i=new Deferred:i;a&&c.promise().done(a);if(!b)return c.promise();if(location.protocol!="http:"&&location.protocol!="https:")return c.reject("apng-canvas doesn't work on pages loaded by '"+location.protocol+"' protocol"),c.promise();this.checkNativeFeatures().done(function(a){a.canvas&&!a.apng?c.resolve():(a.canvas||c.reject("Browser doesn't support canvas"),a.apng&&c.reject("Browser has native APNG support"))}).done(function(){c.reject()});return c.promise()};
h.createAPNGCanvas=function(a,b){var c=new Deferred;b&&c.promise().done(b);e(a).done(function(a){u(a).done(function(b){var e=document.createElement("canvas");e.width=b.width;e.height=b.height;if(b.isAnimated)v(b,e);else{var g=new Image;g.onload=function(){e.getContext("2d").drawImage(g,0,0)};b=new p;b.append(a);g.src=b.getUrl("image/png")}c.resolve(e)}).fail(function(a){c.reject(a)})}).fail(function(a){c.reject(a)});return c.promise()};h.replaceImage=function(a){return h.createAPNGCanvas(a.src).done(function(b){a.parentNode.insertBefore(b,
a);a.parentNode.removeChild(a)})};var b=function(a){for(var b=0,c=0;c<4;c++)b+=a.charCodeAt(c)<<(3-c)*8;return b},o=function(a){for(var b=0,c=0;c<2;c++)b+=a.charCodeAt(c)<<(1-c)*8;return b},n=function(a,b){var c="";c+=j(b.length);c+=a;c+=b;c+=j(crc32(a+b));return c},j=function(a){return String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,a&255)},p=function(){this.parts=[]};p.prototype.append=function(a){this.parts.push(a)};p.prototype.getUrl=function(a){return"data:"+a+","+escape(this.parts.join(""))};
typeof XMLHttpRequest.prototype.responseBody!="undefined"&&typeof document.addEventListener!="undefined"&&document.addEventListener("DOMContentLoaded",function(){var a=document.createElement("script");a.setAttribute("type","text/vbscript");a.text="Function APNGIEBinaryToBinStr(Binary)\r\n   APNGIEBinaryToBinStr = CStr(Binary)\r\nEnd Function\r\n";document.body.appendChild(a)});var e=function(a){var b=new Deferred,c=new XMLHttpRequest;c.open("GET",a,!0);typeof c.responseType!="undefined"?c.responseType=
"arraybuffer":typeof c.overrideMimeType!="undefined"&&c.overrideMimeType("text/plain; charset=x-user-defined");c.onreadystatechange=function(){if(this.readyState==4&&this.status==200)if(typeof this.response!="undefined"){var a=new (l.BlobBuilder||l.WebKitBlobBuilder);a.append(this.response);var e=new FileReader;e.onload=function(){b.resolve(this.result)};e.readAsBinaryString(a.getBlob())}else{a="";if(typeof this.responseBody!="undefined")for(var e=APNGIEBinaryToBinStr(this.responseBody),d=0,g=e.length;d<
g;d++){var f=e.charCodeAt(d);a+=String.fromCharCode(f&255,f>>8&255)}else{e=this.responseText;d=0;for(g=e.length;d<g;++d)a+=String.fromCharCode(e.charCodeAt(d)&255)}b.resolve(a)}else this.readyState==4&&b.reject(c)};c.send();return b.promise()},u=function(a){var e=new Deferred;if(a.substr(0,8)!="PNG\r\n\n")return e.reject("Invalid PNG file signature"),e.promise();var c={width:0,height:0,isAnimated:!1,numPlays:0,frames:[]},d,q="",i="",g=8,f=null;do{var k=b(a.substr(g,4)),h=a.substr(g+4,4),m;switch(h){case "IHDR":d=
m=a.substr(g+8,k);c.width=b(m.substr(0,4));c.height=b(m.substr(4,4));break;case "acTL":c.isAnimated=!0;c.numPlays=b(a.substr(g+8+4,4));break;case "fcTL":f&&c.frames.push(f);m=a.substr(g+8,k);f={};f.width=b(m.substr(4,4));f.height=b(m.substr(8,4));f.left=b(m.substr(12,4));f.top=b(m.substr(16,4));var l=o(m.substr(20,2)),s=o(m.substr(22,2));s==0&&(s=100);f.delay=1E3*l/s;f.disposeOp=m.charCodeAt(24);f.blendOp=m.charCodeAt(25);f.dataParts=[];break;case "fdAT":f&&f.dataParts.push(a.substr(g+8+4,k-4));break;
case "IDAT":f&&f.dataParts.push(a.substr(g+8,k));break;case "IEND":i=a.substr(g,k+12);break;default:q+=a.substr(g,k+12)}g+=12+k}while(h!="IEND"&&g<a.length);f&&c.frames.push(f);c.isAnimated||e.resolve(c);for(var t=0,a=0;a<c.frames.length;a++){g=new Image;f=c.frames[a];f.img=g;g.onload=function(){t++;t==c.frames.length&&e.resolve(c)};g.onerror=function(){e.reject("Image creation error")};k=new p;k.append("PNG\r\n\n");d=j(f.width)+j(f.height)+d.substr(8);k.append(n("IHDR",d));k.append(q);for(h=0;h<
f.dataParts.length;h++)k.append(n("IDAT",f.dataParts[h]));k.append(i);g.src=k.getUrl("image/png");delete f.dataParts}return e.promise()},v=function(a,b){var c=b.getContext("2d"),e=0,d=null,h=function(){var b=e++%a.frames.length,f=a.frames[b];if(b==0&&(c.clearRect(0,0,a.width,a.height),d=null,f.disposeOp==2))f.disposeOp=1;d&&d.disposeOp==1?c.clearRect(d.left,d.top,d.width,d.height):d&&d.disposeOp==2&&c.putImageData(d.iData,d.left,d.top);d=f;d.iData=null;if(d.disposeOp==2)d.iData=c.getImageData(f.left,
f.top,f.width,f.height);f.blendOp==0&&c.clearRect(f.left,f.top,f.width,f.height);c.drawImage(f.img,f.left,f.top);(a.numPlays==0||e/a.frames.length<a.numPlays)&&setTimeout(h,f.delay)};h()}})();
