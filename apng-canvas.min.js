(function(){var f=function(){return this}();f.Deferred=typeof f.jQuery!=="undefined"&&typeof f.jQuery.Deferred!=="undefined"?f.jQuery.Deferred:function(){if(!(this instanceof arguments.callee))return new f.Deferred;var k=[0,[],[]],j=0,m,i=null,p,l=this,q=function(a,c,b){if(!j){j=a;m=c;for(a=k[a];a.length;)a.shift().apply(b,m);k=null;return l}},r=function(a,c){j==a?c.apply(this,m):j||k[a].push(c);return this};l.promise=function(a){if(!a&&i)return i;i=a?a:i?i:{};for(var c in p)p.hasOwnProperty(c)&&
(i[c]=p[c]);return i};l.resolve=function(){return q(1,arguments,i)};l.reject=function(){return q(2,arguments,i)};l.resolveWith=function(){var a=arguments.shift();return q(1,arguments,a)};l.rejectWith=function(){var a=arguments.shift();return q(2,arguments,a)};p={done:function(a){return r.call(this,1,a)},fail:function(a){return r.call(this,2,a)},then:function(a,c){return this.done(a).fail(c)},always:function(a){return this.then(a,a)},isResolved:function(){return j==1},isRejected:function(){return j==
2}}}})();(function(){for(var f=function(){return this}(),k=Array(256),j=0;j<256;j++){for(var m=j,i=0;i<8;i++)m=m&1?3988292384^m>>>1:m>>>1;k[j]=m}f.crc32=function(i){for(var j=-1,f=0,m=i.length;f<m;f++)j=j>>>8^k[(j^i.charCodeAt(f))&255];return j^-1}})();(function(){var f=function(){return this}().APNG={};f.checkNativeFeatures=function(a){var c=!arguments.callee.d,b=c?arguments.callee.d=new Deferred:arguments.callee.d;a&&b.promise().done(function(b){a(b)});if(!c)return b.promise();var s={canvas:!1,apng:!1},e=document.createElement("canvas");if(typeof e.getContext=="undefined")b.resolve(s);else{s.canvas=!0;var h=new Image;h.onload=function(){var a=e.getContext("2d");a.drawImage(h,0,0);if(a.getImageData(0,0,1,1).data[3]===0)s.apng=!0;b.resolve(s)};
h.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACGFjVEwAAAABAAAAAcMq2TYAAAANSURBVAiZY2BgYPgPAAEEAQB9ssjfAAAAGmZjVEwAAAAAAAAAAQAAAAEAAAAAAAAAAAD6A+gBAbNU+2sAAAARZmRBVAAAAAEImWNgYGBgAAAABQAB6MzFdgAAAABJRU5ErkJggg=="}return b.promise()};f.ready=function(a){var c=!arguments.callee.d,b=c?arguments.callee.d=new Deferred:arguments.callee.d;a&&b.promise().done(a);if(!c)return b.promise();if(location.protocol!="http:"&&location.protocol!="https:")return b.reject("apng-canvas doesn't work on pages loaded by '"+
location.protocol+"' protocol"),b.promise();this.checkNativeFeatures().done(function(a){if(a.canvas&&!a.apng){if(typeof XMLHttpRequest.prototype.responseBody!="undefined")a=document.createElement("script"),a.setAttribute("type","text/vbscript"),a.text="Function IEBinaryToBinStr(Binary)\r\n   IEBinaryToBinStr = CStr(Binary)\r\nEnd Function\r\n",document.body.appendChild(a);b.resolve()}else a.canvas||b.reject("Browser doesn't support canvas"),a.apng&&b.reject("Browser has native APNG support")}).done(function(){b.reject()});
return b.promise()};f.createAPNGCanvas=function(a,c){var b=new Deferred;c&&b.promise().done(c);l(a).done(function(a){q(a).done(function(c){var h=document.createElement("canvas");h.width=c.width;h.height=c.height;if(c.isAnimated)r(c,h);else{var g=new Image;g.onload=function(){h.getContext("2d").drawImage(g,0,0)};c=new p;c.append(a);g.src=c.getUrl("image/png")}b.resolve(h)}).fail(function(a){b.reject(a)})}).fail(function(a){b.reject(a)});return b.promise()};f.replaceImage=function(a){return f.createAPNGCanvas(a.src).done(function(c){a.parentNode.insertBefore(c,
a);a.parentNode.removeChild(a)})};var k=function(a){for(var c=0,b=0;b<4;b++)c+=a.charCodeAt(b)<<(3-b)*8;return c},j=function(a){for(var c=0,b=0;b<2;b++)c+=a.charCodeAt(b)<<(1-b)*8;return c},m=function(a,c){var b="";b+=i(c.length);b+=a;b+=c;b+=i(crc32(a+c));return b},i=function(a){return String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,a&255)},p=function(){this.parts=[]};p.prototype.append=function(a){this.parts.push(a)};p.prototype.getUrl=function(a){return"data:"+a+","+escape(this.parts.join(""))};
var l=function(a){var c=new Deferred,b=new XMLHttpRequest;b.open("GET",a,!0);typeof b.responseType!="undefined"?b.responseType="arraybuffer":typeof b.overrideMimeType!="undefined"&&b.overrideMimeType("text/plain; charset=x-user-defined");b.onreadystatechange=function(){if(this.readyState==4&&this.status==200)if(typeof this.response!="undefined"){var a=new (self.BlobBuilder||self.WebKitBlobBuilder);a.append(this.response);var e=new FileReader;e.onload=function(){c.resolve(this.result)};e.readAsBinaryString(a.getBlob())}else{a=
"";if(typeof this.responseBody!="undefined")for(var e=IEBinaryToBinStr(this.responseBody),h=0,g=e.length;h<g;h++){var d=e.charCodeAt(h);a+=String.fromCharCode(d&255,d>>8&255)}else{e=this.responseText;h=0;for(g=e.length;h<g;++h)a+=String.fromCharCode(e.charCodeAt(h)&255)}c.resolve(a)}else this.readyState==4&&c.reject(b)};b.send();return c.promise()},q=function(a){var c=new Deferred;if(a.substr(0,8)!="PNG\r\n\n")return c.reject("Invalid PNG file signature"),c.promise();var b={width:0,height:0,isAnimated:!1,
numPlays:0,frames:[]},f,e="",h="",g=8,d=null;do{var n=k(a.substr(g,4)),l=a.substr(g+4,4),o;switch(l){case "IHDR":f=o=a.substr(g+8,n);b.width=k(o.substr(0,4));b.height=k(o.substr(4,4));break;case "acTL":b.isAnimated=!0;b.numPlays=k(a.substr(g+8+4,4));break;case "fcTL":d&&b.frames.push(d);o=a.substr(g+8,n);d={};d.width=k(o.substr(4,4));d.height=k(o.substr(8,4));d.left=k(o.substr(12,4));d.top=k(o.substr(16,4));var q=j(o.substr(20,2)),r=j(o.substr(22,2));r==0&&(r=100);d.delay=1E3*q/r;d.disposeOp=o.charCodeAt(24);
d.blendOp=o.charCodeAt(25);d.dataParts=[];break;case "fdAT":d&&d.dataParts.push(a.substr(g+8+4,n-4));break;case "IDAT":d&&d.dataParts.push(a.substr(g+8,n));break;case "IEND":h=a.substr(g,n+12);break;default:e+=a.substr(g,n+12)}g+=12+n}while(l!="IEND"&&g<a.length);d&&b.frames.push(d);b.isAnimated||c.resolve(b);for(var t=0,a=0;a<b.frames.length;a++){g=new Image;d=b.frames[a];d.img=g;g.onload=function(){t++;t==b.frames.length&&c.resolve(b)};g.onerror=function(){c.reject("Image creation error")};n=new p;
n.append("PNG\r\n\n");f=i(d.width)+i(d.height)+f.substr(8);n.append(m("IHDR",f));n.append(e);for(l=0;l<d.dataParts.length;l++)n.append(m("IDAT",d.dataParts[l]));n.append(h);g.src=n.getUrl("image/png");delete d.dataParts}return c.promise()},r=function(a,c){var b=c.getContext("2d"),f=0,e=null,h=function(){var c=f++%a.frames.length,d=a.frames[c];if(c==0&&(b.clearRect(0,0,a.width,a.height),e=null,d.disposeOp==2))d.disposeOp=1;e&&e.disposeOp==1?b.clearRect(e.left,e.top,e.width,e.height):e&&e.disposeOp==
2&&b.putImageData(e.iData,e.left,e.top);e=d;e.iData=null;if(e.disposeOp==2)e.iData=b.getImageData(d.left,d.top,d.width,d.height);d.blendOp==0&&b.clearRect(d.left,d.top,d.width,d.height);b.drawImage(d.img,d.left,d.top);(a.numPlays==0||f/a.frames.length<a.numPlays)&&setTimeout(h,d.delay)};h()}})();
