Canvas APNG
==============

Библиотека для отображения Animated PNG в браузерах, которые поддерживают canvas
(т. е. в Google Chrome, Internet Explorer 9, Apple Safari).

API
-----------

Бибилиотека создаёт глобальный объект **APNG**, имеющий несколько методов.
Все методы работают асинхронно и возвращают *promise*-объекты. Если на странице присутствует jQuery,
то используются его [promises](http://api.jquery.com/category/deferred-object/), в противном случае
используется совместимый интерфейс, поддерживающий методы `done`, `fail`, `then` и `always`.

### APNG.checkFeatures()

Проверяет, поддерживает ли браузер `APNG` и `canvas`. Может вызываться независимо от прочих методов.

**`done`** Аргумент — объект с двумя булевыми полями: `apng` и `canvas`. True в любом поле означает поддержку
браузером соответствующей технологии.

**`fail`** Не вызывается.

### APNG.init()

Подготовка библиотеки к работе. Должен вызываться один раз, остальные методы должны вызываться
из обработчика `done`.

**`done`** Вызывается без аргументов только в том случае, если браузер поддерживает `canvas`
и не поддерживает `APNG`. Только в этом случае имеет смысл применение этой библиотеки.

**`fail`** Вызывается если браузер поддерживает `APNG` или не поддерживает `canvas`. Аргумент —
результат вызова `APNG.checkFeatures`.

### APNG.createAPNGCanvas(url)

Загружает PNG-файл по данному `url`, разбирает его, создаёт элемент `canvas` и запускает анимацию.

**`done`** Аргумент — созданный элемент `canvas`, в котором проигрывается анимация.
Элемент не включён в DOM-дерево, это нужно сделать вручную.

**`fail`** Вызывается если полученные данные не являются корректным PNG-файлом или если произошла
ошибка при разборе данных. Аргумент — строка сообщения об ошибке.

### APNG.replaceImage(img)

Заменяет элемент `img` (`HTMLImageElement`) на `canvas` с анимацией. Параметры обработчиков такие же,
как и у `APNG.createAPNGCanvas`. Замена происходит только если `img` содержит корректный PNG-файл.

Ограничения
-----------

Поскольку изображения загружаются при помощи `XMLHttpRequest`, то домен, на котором расположена
картинка, должен быть тем же, что и домен, на котором расположена страничка.

Если домены разные, то в Chrome/Safari можно использовать
[CORS](http://www.w3.org/TR/cors/ "Cross-Origin Resource Sharing"),
настроив сервер картинок на отдачу заголовка `Access-Control-Allow-Origin: *`.

К сожалению, применить CORS в случае с IE, по видимому, не получится, так как соотв. объект
`XDomainRequest` не позволяет получить ответ в виде двоичных данных
(`XMLHttpRequest` позволяет это сделать через свойство `responseBody`).